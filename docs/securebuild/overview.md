# Hyper Protect Virtual Servers (HPVS) Hosted Trial Process Overview

## Prerequisites

See the [`Prerequisites` page](../prerequisites.md){target=_blank} to complete the prerequisites for this lab. This includes creating accounts and credentials to access the Source Code Management (SCM) [GitHub](https://github.com){target=_blank} and the Docker Image Management (Docker Registry) [Docker Hub](https://hub.docker.com/){target=_blank} for the lab.

## The Big Picture

There are 5 steps of the Secure Build process:

1. [SETUP](#setup)
2. [BUILD](#build)
3. [REGISTER](#register)
4. [DEPLOY](#deploy)
5. [ACCESS](#access)

(and how to [CLEAN UP](#cleanup)) are explained in more detail in their respective sections below.

### SETUP

Configure your environment with the necessary credentials to connect to [GitHub](https://github.com){target=_blank} and [Docker Hub](https://hub.docker.com/){target=_blank} respectively ([see `Configuring your Environment`](securebuild-setup.md){target=_blank}). Then you must create the certificate and key to securely communicate with secure build server. See [`Create Certificate and Key`](certificate-create.md){target=_blank}.

### BUILD

Securely build a Docker Image. See [`Create your HPVS Secure Build Server`](create-server.md){target=_blank}, or [`Create your HPVS Secure Build Server by using the YAML configuration file and `hpvs deploy` command`](create-server-hpvsdeploy.md){target=_blank}, and [`Securely Build your Application`](build.md){target=_blank}).

The Secure Build Process leverages a **Hyper Protect Virtual Server**, called the Secure Build Server, to establish trust and security in the [Docker Content Trust](https://docs.docker.com/engine/security/trust/content_trust/){target=_blank} process. This ensure images verified using the [Notary service architecture](https://docs.docker.com/notary/service_architecture/){target=_blank} were safely built and signed. This is done by generating the repository and root keys used to establish trust with the [Notary Service](https://docs.docker.com/notary/service_architecture/){target=_blank} inside of the Secure Build server to guarantee that the initial keys used for a repository are trusted on first use (solving the [TOFU](https://en.wikipedia.org/wiki/Trust_on_first_use){target=_blank} problem).

The table details The full list of the keys used during the Secure Build lifecycle.

| Key Name  | Key Function | Private Key Location | How Created | Owned by Whom |
|---|---|---|---|---|
| Image Signing Key | Pushing Docker images to a Docker repository | Encrypted volume on the Secure Build container | Created by the remote registry server on first push to the remote repository, and written to Secure Build container |  ISV or application developer  |
| Manifest Signing Key | Signing a manifest created by Secure Build | Encrypted volume on the Secure Build container | Created by the Secure Build container when an image is built |  ISV or application developer |
| Session Key | Used to encrypt the Secure Build container backup image | Hosting Appliance zHSM | Generated by a request to backup container snapshots to Cloud Object Store. New key generated each time backup to Cloud Object Store is requested |   Cloud administrator |
| Container Key | Used to encrypt the Session Key (additional layer of encryption) | Hosting Appliance zHSM | Generated by a call to the Hosting Appliance's POST `/disaster_recovery/keys/{container_name}` REST API endpoint. See [here](https://pages.github.ibm.com/ZaaS/scaas/release-docs/release_3.4.0/openapi-docs/#operation/generate_key) |  Cloud administrator |
| Client certificate and Key | Used by the cloud administrator to securely interact with the Secure Build REST API, contains certificate and private key | Client | Created on creation of the Secure Build container and provided to the client as the file specified in their CLIENT_CRT_KEY setting | Cloud administrator |


### REGISTER

Register your securely built Docker Image with your Secure Service Container to verify its validity. See [`Deploy your Securely Built Application as a Hyper Protect Virtual Server`](deploy.md){target=_blank}.


### DEPLOY

Deploy your application `(from the verified repository)` as a Hyper Protect Virtual Server within its own secure environment (see [`Deploy your Securely Built Application as a Hyper Protect Virtual Server`](deploy-app.md){target=_blank}).

### ACCESS

Access your application. xxxx- ToDo

### CLEANUP

Clean up your environment for future users (see [`Clean up your environment`](cleanup.md){target=_blank}).
